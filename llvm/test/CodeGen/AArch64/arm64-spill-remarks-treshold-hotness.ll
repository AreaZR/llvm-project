; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 4
; RUN: llc < %s -mtriple=arm64-apple-ios7.0 -aarch64-neon-syntax=apple -pass-remarks-missed=regalloc \
; RUN:       -pass-remarks-with-hotness 2>&1 | FileCheck %s

; RUN: llc < %s -mtriple=arm64-apple-ios7.0 -aarch64-neon-syntax=apple -pass-remarks-missed=regalloc \
; RUN:       -pass-remarks-with-hotness -pass-remarks-hotness-threshold=1 \
; RUN:       2>&1 | FileCheck -check-prefix=THRESHOLD %s

; CHECK: remark: /tmp/kk.c:3:20: 1 spills 3.200000e+01 total spills cost 1 reloads 3.200000e+01 total reloads cost generated in loop{{$}}
; THRESHOLD-NOT: remark

define void @fpr128(ptr %p) nounwind ssp {
; CHECK-LABEL: fpr128:
; CHECK:       ; %bb.0: ; %entry
; CHECK-NEXT:    sub sp, sp, #176
; CHECK-NEXT:    mov w8, wzr
; CHECK-NEXT:    stp d15, d14, [sp, #16] ; 16-byte Folded Spill
; CHECK-NEXT:    stp d13, d12, [sp, #32] ; 16-byte Folded Spill
; CHECK-NEXT:    stp d11, d10, [sp, #48] ; 16-byte Folded Spill
; CHECK-NEXT:    stp d9, d8, [sp, #64] ; 16-byte Folded Spill
; CHECK-NEXT:    stp x28, x27, [sp, #80] ; 16-byte Folded Spill
; CHECK-NEXT:    stp x26, x25, [sp, #96] ; 16-byte Folded Spill
; CHECK-NEXT:    stp x24, x23, [sp, #112] ; 16-byte Folded Spill
; CHECK-NEXT:    stp x22, x21, [sp, #128] ; 16-byte Folded Spill
; CHECK-NEXT:    stp x20, x19, [sp, #144] ; 16-byte Folded Spill
; CHECK-NEXT:    stp x29, x30, [sp, #160] ; 16-byte Folded Spill
; CHECK-NEXT:  LBB0_1: ; %loop
; CHECK-NEXT:    ; =>This Loop Header: Depth=1
; CHECK-NEXT:    ; Child Loop BB0_2 Depth 2
; CHECK-NEXT:    str w8, [sp, #8] ; 4-byte Folded Spill
; CHECK-NEXT:    mov w8, wzr
; CHECK-NEXT:  LBB0_2: ; %loop2
; CHECK-NEXT:    ; Parent Loop BB0_1 Depth=1
; CHECK-NEXT:    ; => This Inner Loop Header: Depth=2
; CHECK-NEXT:    str w8, [sp, #12] ; 4-byte Folded Spill
; CHECK-NEXT:    ; InlineAsm Start
; CHECK-NEXT:    ; inlineasm
; CHECK-NEXT:    ; InlineAsm End
; CHECK-NEXT:    ldr w8, [sp, #12] ; 4-byte Folded Reload
; CHECK-NEXT:    add w8, w8, #1
; CHECK-NEXT:    cmp w8, #100
; CHECK-NEXT:    b.lt LBB0_2
; CHECK-NEXT:  ; %bb.3: ; %end2
; CHECK-NEXT:    ; in Loop: Header=BB0_1 Depth=1
; CHECK-NEXT:    ; InlineAsm Start
; CHECK-NEXT:    ; inlineasm
; CHECK-NEXT:    ; InlineAsm End
; CHECK-NEXT:    ldr w8, [sp, #8] ; 4-byte Folded Reload
; CHECK-NEXT:    add w8, w8, #1
; CHECK-NEXT:    cmp w8, #100
; CHECK-NEXT:    b.lt LBB0_1
; CHECK-NEXT:  ; %bb.4: ; %loop3.preheader
; CHECK-NEXT:    mov w8, wzr
; CHECK-NEXT:  LBB0_5: ; %loop3
; CHECK-NEXT:    ; =>This Inner Loop Header: Depth=1
; CHECK-NEXT:    str w8, [sp, #12] ; 4-byte Folded Spill
; CHECK-NEXT:    ; InlineAsm Start
; CHECK-NEXT:    ; inlineasm
; CHECK-NEXT:    ; InlineAsm End
; CHECK-NEXT:    ldr w8, [sp, #12] ; 4-byte Folded Reload
; CHECK-NEXT:    add w8, w8, #1
; CHECK-NEXT:    cmp w8, #100
; CHECK-NEXT:    b.lt LBB0_5
; CHECK-NEXT:  ; %bb.6: ; %end3
; CHECK-NEXT:    ldp x29, x30, [sp, #160] ; 16-byte Folded Reload
; CHECK-NEXT:    ldp x20, x19, [sp, #144] ; 16-byte Folded Reload
; CHECK-NEXT:    ldp x22, x21, [sp, #128] ; 16-byte Folded Reload
; CHECK-NEXT:    ldp x24, x23, [sp, #112] ; 16-byte Folded Reload
; CHECK-NEXT:    ldp x26, x25, [sp, #96] ; 16-byte Folded Reload
; CHECK-NEXT:    ldp x28, x27, [sp, #80] ; 16-byte Folded Reload
; CHECK-NEXT:    ldp d9, d8, [sp, #64] ; 16-byte Folded Reload
; CHECK-NEXT:    ldp d11, d10, [sp, #48] ; 16-byte Folded Reload
; CHECK-NEXT:    ldp d13, d12, [sp, #32] ; 16-byte Folded Reload
; CHECK-NEXT:    ldp d15, d14, [sp, #16] ; 16-byte Folded Reload
; CHECK-NEXT:    add sp, sp, #176
; CHECK-NEXT:    ret
;
; THRESHOLD-LABEL: fpr128:
; THRESHOLD:       ; %bb.0: ; %entry
; THRESHOLD-NEXT:    sub sp, sp, #176
; THRESHOLD-NEXT:    mov w8, wzr
; THRESHOLD-NEXT:    stp d15, d14, [sp, #16] ; 16-byte Folded Spill
; THRESHOLD-NEXT:    stp d13, d12, [sp, #32] ; 16-byte Folded Spill
; THRESHOLD-NEXT:    stp d11, d10, [sp, #48] ; 16-byte Folded Spill
; THRESHOLD-NEXT:    stp d9, d8, [sp, #64] ; 16-byte Folded Spill
; THRESHOLD-NEXT:    stp x28, x27, [sp, #80] ; 16-byte Folded Spill
; THRESHOLD-NEXT:    stp x26, x25, [sp, #96] ; 16-byte Folded Spill
; THRESHOLD-NEXT:    stp x24, x23, [sp, #112] ; 16-byte Folded Spill
; THRESHOLD-NEXT:    stp x22, x21, [sp, #128] ; 16-byte Folded Spill
; THRESHOLD-NEXT:    stp x20, x19, [sp, #144] ; 16-byte Folded Spill
; THRESHOLD-NEXT:    stp x29, x30, [sp, #160] ; 16-byte Folded Spill
; THRESHOLD-NEXT:  LBB0_1: ; %loop
; THRESHOLD-NEXT:    ; =>This Loop Header: Depth=1
; THRESHOLD-NEXT:    ; Child Loop BB0_2 Depth 2
; THRESHOLD-NEXT:    str w8, [sp, #8] ; 4-byte Folded Spill
; THRESHOLD-NEXT:    mov w8, wzr
; THRESHOLD-NEXT:  LBB0_2: ; %loop2
; THRESHOLD-NEXT:    ; Parent Loop BB0_1 Depth=1
; THRESHOLD-NEXT:    ; => This Inner Loop Header: Depth=2
; THRESHOLD-NEXT:    str w8, [sp, #12] ; 4-byte Folded Spill
; THRESHOLD-NEXT:    ; InlineAsm Start
; THRESHOLD-NEXT:    ; inlineasm
; THRESHOLD-NEXT:    ; InlineAsm End
; THRESHOLD-NEXT:    ldr w8, [sp, #12] ; 4-byte Folded Reload
; THRESHOLD-NEXT:    add w8, w8, #1
; THRESHOLD-NEXT:    cmp w8, #100
; THRESHOLD-NEXT:    b.lt LBB0_2
; THRESHOLD-NEXT:  ; %bb.3: ; %end2
; THRESHOLD-NEXT:    ; in Loop: Header=BB0_1 Depth=1
; THRESHOLD-NEXT:    ; InlineAsm Start
; THRESHOLD-NEXT:    ; inlineasm
; THRESHOLD-NEXT:    ; InlineAsm End
; THRESHOLD-NEXT:    ldr w8, [sp, #8] ; 4-byte Folded Reload
; THRESHOLD-NEXT:    add w8, w8, #1
; THRESHOLD-NEXT:    cmp w8, #100
; THRESHOLD-NEXT:    b.lt LBB0_1
; THRESHOLD-NEXT:  ; %bb.4: ; %loop3.preheader
; THRESHOLD-NEXT:    mov w8, wzr
; THRESHOLD-NEXT:  LBB0_5: ; %loop3
; THRESHOLD-NEXT:    ; =>This Inner Loop Header: Depth=1
; THRESHOLD-NEXT:    str w8, [sp, #12] ; 4-byte Folded Spill
; THRESHOLD-NEXT:    ; InlineAsm Start
; THRESHOLD-NEXT:    ; inlineasm
; THRESHOLD-NEXT:    ; InlineAsm End
; THRESHOLD-NEXT:    ldr w8, [sp, #12] ; 4-byte Folded Reload
; THRESHOLD-NEXT:    add w8, w8, #1
; THRESHOLD-NEXT:    cmp w8, #100
; THRESHOLD-NEXT:    b.lt LBB0_5
; THRESHOLD-NEXT:  ; %bb.6: ; %end3
; THRESHOLD-NEXT:    ldp x29, x30, [sp, #160] ; 16-byte Folded Reload
; THRESHOLD-NEXT:    ldp x20, x19, [sp, #144] ; 16-byte Folded Reload
; THRESHOLD-NEXT:    ldp x22, x21, [sp, #128] ; 16-byte Folded Reload
; THRESHOLD-NEXT:    ldp x24, x23, [sp, #112] ; 16-byte Folded Reload
; THRESHOLD-NEXT:    ldp x26, x25, [sp, #96] ; 16-byte Folded Reload
; THRESHOLD-NEXT:    ldp x28, x27, [sp, #80] ; 16-byte Folded Reload
; THRESHOLD-NEXT:    ldp d9, d8, [sp, #64] ; 16-byte Folded Reload
; THRESHOLD-NEXT:    ldp d11, d10, [sp, #48] ; 16-byte Folded Reload
; THRESHOLD-NEXT:    ldp d13, d12, [sp, #32] ; 16-byte Folded Reload
; THRESHOLD-NEXT:    ldp d15, d14, [sp, #16] ; 16-byte Folded Reload
; THRESHOLD-NEXT:    add sp, sp, #176
; THRESHOLD-NEXT:    ret
entry:
  br label %loop, !dbg !8

loop:
  %i = phi i32 [ 0, %entry], [ %i.2, %end2 ]
  br label %loop2, !dbg !9

loop2:
  %j = phi i32 [ 0, %loop], [ %j.2, %loop2 ]
  call void asm sideeffect "; inlineasm", "~{q0},~{q1},~{q2},~{q3},~{q4},~{q5},~{q6},~{q7},~{q8},~{q9},~{q10},~{q11},~{q12},~{q13},~{q14},~{q15},~{q16},~{q17},~{q18},~{q19},~{q20},~{q21},~{q22},~{q23},~{q24},~{q25},~{q26},~{q27},~{q28},~{q29},~{q30},~{q31},~{x0},~{x1},~{x2},~{x3},~{x4},~{x5},~{x6},~{x7},~{x8},~{x9},~{x10},~{x11},~{x12},~{x13},~{x14},~{x15},~{x16},~{x17},~{x18},~{x19},~{x20},~{x21},~{x22},~{x23},~{x24},~{x25},~{x26},~{x27},~{x28},~{fp},~{lr},~{sp},~{memory}"() nounwind
  %j.2 = add i32 %j, 1
  %c2 = icmp slt i32 %j.2, 100
  br i1 %c2, label %loop2, label %end2

end2:
  call void asm sideeffect "; inlineasm", "~{q0},~{q1},~{q2},~{q3},~{q4},~{q5},~{q6},~{q7},~{q8},~{q9},~{q10},~{q11},~{q12},~{q13},~{q14},~{q15},~{q16},~{q17},~{q18},~{q19},~{q20},~{q21},~{q22},~{q23},~{q24},~{q25},~{q26},~{q27},~{q28},~{q29},~{q30},~{q31},~{x0},~{x1},~{x2},~{x3},~{x4},~{x5},~{x6},~{x7},~{x8},~{x9},~{x10},~{x11},~{x12},~{x13},~{x14},~{x15},~{x16},~{x17},~{x18},~{x19},~{x20},~{x21},~{x22},~{x23},~{x24},~{x25},~{x26},~{x27},~{x28},~{fp},~{lr},~{sp},~{memory}"() nounwind
  %i.2 = add i32 %i, 1
  %c = icmp slt i32 %i.2, 100
  br i1 %c, label %loop, label %end

end:
  br label %loop3

loop3:
  %k = phi i32 [ 0, %end], [ %k.2, %loop3 ]
  call void asm sideeffect "; inlineasm", "~{q0},~{q1},~{q2},~{q3},~{q4},~{q5},~{q6},~{q7},~{q8},~{q9},~{q10},~{q11},~{q12},~{q13},~{q14},~{q15},~{q16},~{q17},~{q18},~{q19},~{q20},~{q21},~{q22},~{q23},~{q24},~{q25},~{q26},~{q27},~{q28},~{q29},~{q30},~{q31},~{x0},~{x1},~{x2},~{x3},~{x4},~{x5},~{x6},~{x7},~{x8},~{x9},~{x10},~{x11},~{x12},~{x13},~{x14},~{x15},~{x16},~{x17},~{x18},~{x19},~{x20},~{x21},~{x22},~{x23},~{x24},~{x25},~{x26},~{x27},~{x28},~{fp},~{lr},~{sp},~{memory}"() nounwind
  %k.2 = add i32 %k, 1
  %c3 = icmp slt i32 %k.2, 100
  br i1 %c3, label %loop3, label %end3, !dbg !10

end3:
  ret void
}

!llvm.dbg.cu = !{!0}
!llvm.module.flags = !{!3, !4}
!llvm.ident = !{!5}

!0 = distinct !DICompileUnit(language: DW_LANG_C99, file: !1, producer: "clang version 3.9.0 ", isOptimized: true, runtimeVersion: 0, emissionKind: NoDebug, enums: !2)
!1 = !DIFile(filename: "/tmp/kk.c", directory: "/tmp")
!2 = !{}
!3 = !{i32 2, !"Debug Info Version", i32 3}
!4 = !{i32 1, !"PIC Level", i32 2}
!5 = !{!"clang version 3.9.0 "}
!6 = distinct !DISubprogram(name: "success", scope: !1, file: !1, line: 1, type: !7, isLocal: false, isDefinition: true, scopeLine: 1, flags: DIFlagPrototyped, isOptimized: true, unit: !0, retainedNodes: !2)
!7 = !DISubroutineType(types: !2)
!8 = !DILocation(line: 1, column: 20, scope: !6)
!9 = !DILocation(line: 2, column: 20, scope: !6)
!10 = !DILocation(line: 3, column: 20, scope: !6)
