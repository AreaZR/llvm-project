; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 4
; RUN: llc -mtriple=arm64-apple-ios7.0 %s -o - | FileCheck %s
; RUN: llc -mtriple=arm64-apple-ios7.0 -global-isel -global-isel-abort=1 -verify-machineinstrs %s -o - | FileCheck %s

@var = thread_local global i8 0

; N.b. x0 must be the result of the first load (i.e. the address of the
; descriptor) when tlv_get_addr is called. Likewise the result is returned in
; x0.
define i8 @get_var() {
; CHECK-LABEL: get_var:
; CHECK:       ; %bb.0:
; CHECK-NEXT:    stp x29, x30, [sp, #-16]! ; 16-byte Folded Spill
; CHECK-NEXT:    .cfi_def_cfa_offset 16
; CHECK-NEXT:    .cfi_offset w30, -8
; CHECK-NEXT:    .cfi_offset w29, -16
; CHECK-NEXT:  Lloh0:
; CHECK-NEXT:    adrp x0, _var@TLVPPAGE
; CHECK-NEXT:  Lloh1:
; CHECK-NEXT:    ldr x0, [x0, _var@TLVPPAGEOFF]
; CHECK-NEXT:    ldr x8, [x0]
; CHECK-NEXT:    blr x8
; CHECK-NEXT:    ldrb w0, [x0]
; CHECK-NEXT:    ldp x29, x30, [sp], #16 ; 16-byte Folded Reload
; CHECK-NEXT:    ret
; CHECK-NEXT:    .loh AdrpLdr Lloh0, Lloh1

  %val = load i8, ptr @var, align 1
  ret i8 %val
}
