; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 5
;; Test behavior of -optimize-hot-cold-new and related options.

;; Check that we don't get hot/cold new calls without enabling it explicitly.
; RUN: opt < %s -passes=instcombine -S | FileCheck %s --check-prefix=OFF
; OFF-NOT: hot_cold_t

;; First check with the default cold and hot hint values (255 = -2).
; RUN: opt < %s -passes=instcombine -optimize-hot-cold-new -S | FileCheck %s --check-prefix=HOTCOLD -DCOLD=1 -DHOT=-2 -DPREVHINTCOLD=7 -DPREVHINTNOTCOLD=7 -DPREVHINTHOT=7

;; Next check with the non-default cold and hot hint values (200 =-56).
; RUN: opt < %s -passes=instcombine -optimize-hot-cold-new -cold-new-hint-value=5 -hot-new-hint-value=200 -S | FileCheck %s --check-prefix=HOTCOLD -DCOLD=5 -DHOT=-56 -DPREVHINTCOLD=7 -DPREVHINTNOTCOLD=7 -DPREVHINTHOT=7

;; Try again with the non-default cold and hot hint values (200 =-56), and this
;; time specify that existing hints should be updated.
; RUN: opt < %s -passes=instcombine -optimize-hot-cold-new -cold-new-hint-value=5 -notcold-new-hint-value=100 -hot-new-hint-value=200 -optimize-existing-hot-cold-new -S | FileCheck %s --check-prefix=HOTCOLD -DCOLD=5 -DHOT=-56 -DPREVHINTCOLD=5 -DPREVHINTNOTCOLD=100 -DPREVHINTHOT=-56

;; Make sure that values not in 0..255 are flagged with an error
; RUN: not opt < %s -passes=instcombine -optimize-hot-cold-new -cold-new-hint-value=256 -S 2>&1 | FileCheck %s --check-prefix=ERROR
; RUN: not opt < %s -passes=instcombine -optimize-hot-cold-new -hot-new-hint-value=5000 -S 2>&1 | FileCheck %s --check-prefix=ERROR
; ERROR: value must be in the range [0, 255]!

;; Check that operator new(unsigned long) converted to
;; operator new(unsigned long, __hot_cold_t) with a hot or cold attribute.
define void @new() {
  ;; Attribute cold converted to __hot_cold_t cold value.
; OFF-LABEL: define void @new() {
; OFF-NEXT:    [[CALL:%.*]] = call dereferenceable_or_null(10) ptr @_Znwm(i64 10) #[[ATTR0:[0-9]+]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call dereferenceable_or_null(10) ptr @_Znwm(i64 10) #[[ATTR1:[0-9]+]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call dereferenceable_or_null(10) ptr @_Znwm(i64 10) #[[ATTR2:[0-9]+]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %call = call ptr @_Znwm(i64 10) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold has no effect.
  %call1 = call ptr @_Znwm(i64 10) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_Znwm(i64 10) #2
  call void @dummy(ptr %call2)
  ret void
}

;; Check that operator new(unsigned long, std::align_val_t) converted to
;; operator new(unsigned long, std::align_val_t, __hot_cold_t) with a hot or
;; cold attribute.
define void @new_align() {
  ;; Attribute cold converted to __hot_cold_t cold value.
; OFF-LABEL: define void @new_align() {
; OFF-NEXT:    [[CALL:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnwmSt11align_val_t(i64 10, i64 8) #[[ATTR0]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnwmSt11align_val_t(i64 10, i64 8) #[[ATTR1]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnwmSt11align_val_t(i64 10, i64 8) #[[ATTR2]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %call = call ptr @_ZnwmSt11align_val_t(i64 10, i64 8) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold has no effect.
  %call1 = call ptr @_ZnwmSt11align_val_t(i64 10, i64 8) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_ZnwmSt11align_val_t(i64 10, i64 8) #2
  call void @dummy(ptr %call2)
  ret void
}

;; Check that operator new(unsigned long, const std::nothrow_t&) converted to
;; operator new(unsigned long, const std::nothrow_t&, __hot_cold_t) with a hot or
;; cold attribute.
define void @new_nothrow() {
; OFF-LABEL: define void @new_nothrow() {
; OFF-NEXT:    [[NT:%.*]] = alloca i8, align 1
; OFF-NEXT:    [[CALL:%.*]] = call dereferenceable_or_null(10) ptr @_ZnwmRKSt9nothrow_t(i64 10, ptr nonnull [[NT]]) #[[ATTR0]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call dereferenceable_or_null(10) ptr @_ZnwmRKSt9nothrow_t(i64 10, ptr nonnull [[NT]]) #[[ATTR1]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call dereferenceable_or_null(10) ptr @_ZnwmRKSt9nothrow_t(i64 10, ptr nonnull [[NT]]) #[[ATTR2]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %nt = alloca i8
  ;; Attribute cold converted to __hot_cold_t cold value.
  %call = call ptr @_ZnwmRKSt9nothrow_t(i64 10, ptr %nt) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold has no effect.
  %call1 = call ptr @_ZnwmRKSt9nothrow_t(i64 10, ptr %nt) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_ZnwmRKSt9nothrow_t(i64 10, ptr %nt) #2
  call void @dummy(ptr %call2)
  ret void
}

;; Check that operator new(unsigned long, std::align_val_t, const std::nothrow_t&)
;; converted to
;; operator new(unsigned long, std::align_val_t, const std::nothrow_t&, __hot_cold_t)
;; with a hot or cold attribute.
define void @new_align_nothrow() {
; OFF-LABEL: define void @new_align_nothrow() {
; OFF-NEXT:    [[NT:%.*]] = alloca i8, align 1
; OFF-NEXT:    [[CALL:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnwmSt11align_val_tRKSt9nothrow_t(i64 10, i64 8, ptr nonnull [[NT]]) #[[ATTR0]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnwmSt11align_val_tRKSt9nothrow_t(i64 10, i64 8, ptr nonnull [[NT]]) #[[ATTR1]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnwmSt11align_val_tRKSt9nothrow_t(i64 10, i64 8, ptr nonnull [[NT]]) #[[ATTR2]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %nt = alloca i8
  ;; Attribute cold converted to __hot_cold_t cold value.
  %call = call ptr @_ZnwmSt11align_val_tRKSt9nothrow_t(i64 10, i64 8, ptr %nt) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold has no effect.
  %call1 = call ptr @_ZnwmSt11align_val_tRKSt9nothrow_t(i64 10, i64 8, ptr %nt) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_ZnwmSt11align_val_tRKSt9nothrow_t(i64 10, i64 8, ptr %nt) #2
  call void @dummy(ptr %call2)
  ret void
}

;; Check that operator new[](unsigned long) converted to
;; operator new[](unsigned long, __hot_cold_t) with a hot or cold attribute.
define void @array_new() {
  ;; Attribute cold converted to __hot_cold_t cold value.
; OFF-LABEL: define void @array_new() {
; OFF-NEXT:    [[CALL:%.*]] = call dereferenceable_or_null(10) ptr @_Znam(i64 10) #[[ATTR0]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call dereferenceable_or_null(10) ptr @_Znam(i64 10) #[[ATTR1]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call dereferenceable_or_null(10) ptr @_Znam(i64 10) #[[ATTR2]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %call = call ptr @_Znam(i64 10) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold has no effect.
  %call1 = call ptr @_Znam(i64 10) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_Znam(i64 10) #2
  call void @dummy(ptr %call2)
  ret void
}

;; Check that operator new[](unsigned long, std::align_val_t) converted to
;; operator new[](unsigned long, std::align_val_t, __hot_cold_t) with a hot or
;; cold attribute.
define void @array_new_align() {
  ;; Attribute cold converted to __hot_cold_t cold value.
; OFF-LABEL: define void @array_new_align() {
; OFF-NEXT:    [[CALL:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnamSt11align_val_t(i64 10, i64 8) #[[ATTR0]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnamSt11align_val_t(i64 10, i64 8) #[[ATTR1]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnamSt11align_val_t(i64 10, i64 8) #[[ATTR2]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %call = call ptr @_ZnamSt11align_val_t(i64 10, i64 8) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold has no effect.
  %call1 = call ptr @_ZnamSt11align_val_t(i64 10, i64 8) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_ZnamSt11align_val_t(i64 10, i64 8) #2
  call void @dummy(ptr %call2)
  ret void
}

;; Check that operator new[](unsigned long, const std::nothrow_t&) converted to
;; operator new[](unsigned long, const std::nothrow_t&, __hot_cold_t) with a hot or
;; cold attribute.
define void @array_new_nothrow() {
; OFF-LABEL: define void @array_new_nothrow() {
; OFF-NEXT:    [[NT:%.*]] = alloca i8, align 1
; OFF-NEXT:    [[CALL:%.*]] = call dereferenceable_or_null(10) ptr @_ZnamRKSt9nothrow_t(i64 10, ptr nonnull [[NT]]) #[[ATTR0]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call dereferenceable_or_null(10) ptr @_ZnamRKSt9nothrow_t(i64 10, ptr nonnull [[NT]]) #[[ATTR1]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call dereferenceable_or_null(10) ptr @_ZnamRKSt9nothrow_t(i64 10, ptr nonnull [[NT]]) #[[ATTR2]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %nt = alloca i8
  ;; Attribute cold converted to __hot_cold_t cold value.
  %call = call ptr @_ZnamRKSt9nothrow_t(i64 10, ptr %nt) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold has no effect.
  %call1 = call ptr @_ZnamRKSt9nothrow_t(i64 10, ptr %nt) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_ZnamRKSt9nothrow_t(i64 10, ptr %nt) #2
  call void @dummy(ptr %call2)
  ret void
}

;; Check that operator new[](unsigned long, std::align_val_t, const std::nothrow_t&)
;; converted to
;; operator new[](unsigned long, std::align_val_t, const std::nothrow_t&, __hot_cold_t)
;; with a hot or cold attribute.
define void @array_new_align_nothrow() {
; OFF-LABEL: define void @array_new_align_nothrow() {
; OFF-NEXT:    [[NT:%.*]] = alloca i8, align 1
; OFF-NEXT:    [[CALL:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnamSt11align_val_tRKSt9nothrow_t(i64 10, i64 8, ptr nonnull [[NT]]) #[[ATTR0]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnamSt11align_val_tRKSt9nothrow_t(i64 10, i64 8, ptr nonnull [[NT]]) #[[ATTR1]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnamSt11align_val_tRKSt9nothrow_t(i64 10, i64 8, ptr nonnull [[NT]]) #[[ATTR2]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %nt = alloca i8
  ;; Attribute cold converted to __hot_cold_t cold value.
  %call = call ptr @_ZnamSt11align_val_tRKSt9nothrow_t(i64 10, i64 8, ptr %nt) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold has no effect.
  %call1 = call ptr @_ZnamSt11align_val_tRKSt9nothrow_t(i64 10, i64 8, ptr %nt) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_ZnamSt11align_val_tRKSt9nothrow_t(i64 10, i64 8, ptr %nt) #2
  call void @dummy(ptr %call2)
  ret void
}

;; Check that operator new(unsigned long, __hot_cold_t)
;; optionally has its hint updated.
define void @new_hot_cold() {
  ;; Attribute cold converted to __hot_cold_t cold value.
; OFF-LABEL: define void @new_hot_cold() {
; OFF-NEXT:    [[CALL:%.*]] = call dereferenceable_or_null(10) ptr @_Znwm12__hot_cold_t(i64 10, i8 7) #[[ATTR0]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call dereferenceable_or_null(10) ptr @_Znwm12__hot_cold_t(i64 10, i8 7) #[[ATTR1]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call dereferenceable_or_null(10) ptr @_Znwm12__hot_cold_t(i64 10, i8 7) #[[ATTR2]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %call = call ptr @_Znwm12__hot_cold_t(i64 10, i8 7) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold converted to __hot_cold_t notcold value.
  %call1 = call ptr @_Znwm12__hot_cold_t(i64 10, i8 7) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_Znwm12__hot_cold_t(i64 10, i8 7) #2
  call void @dummy(ptr %call2)
  ret void
}

;; Check that operator new(unsigned long, std::align_val_t, __hot_cold_t)
;; optionally has its hint updated.
define void @new_align_hot_cold() {
  ;; Attribute cold converted to __hot_cold_t cold value.
; OFF-LABEL: define void @new_align_hot_cold() {
; OFF-NEXT:    [[CALL:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnwmSt11align_val_t12__hot_cold_t(i64 10, i64 8, i8 7) #[[ATTR0]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnwmSt11align_val_t12__hot_cold_t(i64 10, i64 8, i8 7) #[[ATTR1]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnwmSt11align_val_t12__hot_cold_t(i64 10, i64 8, i8 7) #[[ATTR2]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %call = call ptr @_ZnwmSt11align_val_t12__hot_cold_t(i64 10, i64 8, i8 7) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold converted to __hot_cold_t notcold value.
  %call1 = call ptr @_ZnwmSt11align_val_t12__hot_cold_t(i64 10, i64 8, i8 7) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_ZnwmSt11align_val_t12__hot_cold_t(i64 10, i64 8, i8 7) #2
  call void @dummy(ptr %call2)
  ret void
}

;; Check that operator new(unsigned long, const std::nothrow_t&, __hot_cold_t)
;; optionally has its hint updated.
define void @new_nothrow_hot_cold() {
; OFF-LABEL: define void @new_nothrow_hot_cold() {
; OFF-NEXT:    [[NT:%.*]] = alloca i8, align 1
; OFF-NEXT:    [[CALL:%.*]] = call dereferenceable_or_null(10) ptr @_ZnwmRKSt9nothrow_t12__hot_cold_t(i64 10, ptr nonnull [[NT]], i8 7) #[[ATTR0]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call dereferenceable_or_null(10) ptr @_ZnwmRKSt9nothrow_t12__hot_cold_t(i64 10, ptr nonnull [[NT]], i8 7) #[[ATTR1]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call dereferenceable_or_null(10) ptr @_ZnwmRKSt9nothrow_t12__hot_cold_t(i64 10, ptr nonnull [[NT]], i8 7) #[[ATTR2]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %nt = alloca i8
  ;; Attribute cold converted to __hot_cold_t cold value.
  %call = call ptr @_ZnwmRKSt9nothrow_t12__hot_cold_t(i64 10, ptr %nt, i8 7) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold converted to __hot_cold_t notcold value.
  %call1 = call ptr @_ZnwmRKSt9nothrow_t12__hot_cold_t(i64 10, ptr %nt, i8 7) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_ZnwmRKSt9nothrow_t12__hot_cold_t(i64 10, ptr %nt, i8 7) #2
  call void @dummy(ptr %call2)
  ret void
}

;; Check that operator new(unsigned long, std::align_val_t, const std::nothrow_t&, __hot_cold_t)
;; optionally has its hint updated.
define void @new_align_nothrow_hot_cold() {
; OFF-LABEL: define void @new_align_nothrow_hot_cold() {
; OFF-NEXT:    [[NT:%.*]] = alloca i8, align 1
; OFF-NEXT:    [[CALL:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnwmSt11align_val_tRKSt9nothrow_t12__hot_cold_t(i64 10, i64 8, ptr nonnull [[NT]], i8 7) #[[ATTR0]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnwmSt11align_val_tRKSt9nothrow_t12__hot_cold_t(i64 10, i64 8, ptr nonnull [[NT]], i8 7) #[[ATTR1]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnwmSt11align_val_tRKSt9nothrow_t12__hot_cold_t(i64 10, i64 8, ptr nonnull [[NT]], i8 7) #[[ATTR2]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %nt = alloca i8
  ;; Attribute cold converted to __hot_cold_t cold value.
  %call = call ptr @_ZnwmSt11align_val_tRKSt9nothrow_t12__hot_cold_t(i64 10, i64 8, ptr %nt, i8 7) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold converted to __hot_cold_t notcold value.
  %call1 = call ptr @_ZnwmSt11align_val_tRKSt9nothrow_t12__hot_cold_t(i64 10, i64 8, ptr %nt, i8 7) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_ZnwmSt11align_val_tRKSt9nothrow_t12__hot_cold_t(i64 10, i64 8, ptr %nt, i8 7) #2
  call void @dummy(ptr %call2)
  ret void
}

;; Check that operator new[](unsigned long, __hot_cold_t)
;; optionally has its hint updated.
define void @array_new_hot_cold() {
  ;; Attribute cold converted to __hot_cold_t cold value.
; OFF-LABEL: define void @array_new_hot_cold() {
; OFF-NEXT:    [[CALL:%.*]] = call dereferenceable_or_null(10) ptr @_Znam12__hot_cold_t(i64 10, i8 7) #[[ATTR0]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call dereferenceable_or_null(10) ptr @_Znam12__hot_cold_t(i64 10, i8 7) #[[ATTR1]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call dereferenceable_or_null(10) ptr @_Znam12__hot_cold_t(i64 10, i8 7) #[[ATTR2]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %call = call ptr @_Znam12__hot_cold_t(i64 10, i8 7) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold converted to __hot_cold_t notcold value.
  %call1 = call ptr @_Znam12__hot_cold_t(i64 10, i8 7) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_Znam12__hot_cold_t(i64 10, i8 7) #2
  call void @dummy(ptr %call2)
  ret void
}

;; Check that operator new[](unsigned long, std::align_val_t, __hot_cold_t)
;; optionally has its hint updated.
define void @array_new_align_hot_cold() {
  ;; Attribute cold converted to __hot_cold_t cold value.
; OFF-LABEL: define void @array_new_align_hot_cold() {
; OFF-NEXT:    [[CALL:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnamSt11align_val_t12__hot_cold_t(i64 10, i64 8, i8 7) #[[ATTR0]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnamSt11align_val_t12__hot_cold_t(i64 10, i64 8, i8 7) #[[ATTR1]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnamSt11align_val_t12__hot_cold_t(i64 10, i64 8, i8 7) #[[ATTR2]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %call = call ptr @_ZnamSt11align_val_t12__hot_cold_t(i64 10, i64 8, i8 7) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold converted to __hot_cold_t notcold value.
  %call1 = call ptr @_ZnamSt11align_val_t12__hot_cold_t(i64 10, i64 8, i8 7) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_ZnamSt11align_val_t12__hot_cold_t(i64 10, i64 8, i8 7) #2
  call void @dummy(ptr %call2)
  ret void
}

;; Check that operator new[](unsigned long, const std::nothrow_t&, __hot_cold_t)
;; optionally has its hint updated.
define void @array_new_nothrow_hot_cold() {
; OFF-LABEL: define void @array_new_nothrow_hot_cold() {
; OFF-NEXT:    [[NT:%.*]] = alloca i8, align 1
; OFF-NEXT:    [[CALL:%.*]] = call dereferenceable_or_null(10) ptr @_ZnamRKSt9nothrow_t12__hot_cold_t(i64 10, ptr nonnull [[NT]], i8 7) #[[ATTR0]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call dereferenceable_or_null(10) ptr @_ZnamRKSt9nothrow_t12__hot_cold_t(i64 10, ptr nonnull [[NT]], i8 7) #[[ATTR1]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call dereferenceable_or_null(10) ptr @_ZnamRKSt9nothrow_t12__hot_cold_t(i64 10, ptr nonnull [[NT]], i8 7) #[[ATTR2]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %nt = alloca i8
  ;; Attribute cold converted to __hot_cold_t cold value.
  %call = call ptr @_ZnamRKSt9nothrow_t12__hot_cold_t(i64 10, ptr %nt, i8 7) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold converted to __hot_cold_t notcold value.
  %call1 = call ptr @_ZnamRKSt9nothrow_t12__hot_cold_t(i64 10, ptr %nt, i8 7) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_ZnamRKSt9nothrow_t12__hot_cold_t(i64 10, ptr %nt, i8 7) #2
  call void @dummy(ptr %call2)
  ret void
}

;; Check that operator new[](unsigned long, std::align_val_t, const std::nothrow_t&, __hot_cold_t)
;; optionally has its hint updated.
define void @array_new_align_nothrow_hot_cold() {
; OFF-LABEL: define void @array_new_align_nothrow_hot_cold() {
; OFF-NEXT:    [[NT:%.*]] = alloca i8, align 1
; OFF-NEXT:    [[CALL:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnamSt11align_val_tRKSt9nothrow_t12__hot_cold_t(i64 10, i64 8, ptr nonnull [[NT]], i8 7) #[[ATTR0]]
; OFF-NEXT:    call void @dummy(ptr [[CALL]])
; OFF-NEXT:    [[CALL1:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnamSt11align_val_tRKSt9nothrow_t12__hot_cold_t(i64 10, i64 8, ptr nonnull [[NT]], i8 7) #[[ATTR1]]
; OFF-NEXT:    call void @dummy(ptr [[CALL1]])
; OFF-NEXT:    [[CALL2:%.*]] = call align 8 dereferenceable_or_null(10) ptr @_ZnamSt11align_val_tRKSt9nothrow_t12__hot_cold_t(i64 10, i64 8, ptr nonnull [[NT]], i8 7) #[[ATTR2]]
; OFF-NEXT:    call void @dummy(ptr [[CALL2]])
; OFF-NEXT:    ret void
;
  %nt = alloca i8
  ;; Attribute cold converted to __hot_cold_t cold value.
  %call = call ptr @_ZnamSt11align_val_tRKSt9nothrow_t12__hot_cold_t(i64 10, i64 8, ptr %nt, i8 7) #0
  call void @dummy(ptr %call)
  ;; Attribute notcold converted to __hot_cold_t notcold value.
  %call1 = call ptr @_ZnamSt11align_val_tRKSt9nothrow_t12__hot_cold_t(i64 10, i64 8, ptr %nt, i8 7) #1
  call void @dummy(ptr %call1)
  ;; Attribute hot converted to __hot_cold_t hot value.
  %call2 = call ptr @_ZnamSt11align_val_tRKSt9nothrow_t12__hot_cold_t(i64 10, i64 8, ptr %nt, i8 7) #2
  call void @dummy(ptr %call2)
  ret void
}

;; So that instcombine doesn't optimize out the call.
declare void @dummy(ptr)

declare ptr @_Znwm(i64)
declare ptr @_ZnwmSt11align_val_t(i64, i64)
declare ptr @_ZnwmRKSt9nothrow_t(i64, ptr)
declare ptr @_ZnwmSt11align_val_tRKSt9nothrow_t(i64, i64, ptr)
declare ptr @_Znam(i64)
declare ptr @_ZnamSt11align_val_t(i64, i64)
declare ptr @_ZnamRKSt9nothrow_t(i64, ptr)
declare ptr @_ZnamSt11align_val_tRKSt9nothrow_t(i64, i64, ptr)
declare ptr @_Znwm12__hot_cold_t(i64, i8)
declare ptr @_ZnwmSt11align_val_t12__hot_cold_t(i64, i64, i8)
declare ptr @_ZnwmRKSt9nothrow_t12__hot_cold_t(i64, ptr, i8)
declare ptr @_ZnwmSt11align_val_tRKSt9nothrow_t12__hot_cold_t(i64, i64, ptr, i8)
declare ptr @_Znam12__hot_cold_t(i64, i8)
declare ptr @_ZnamSt11align_val_t12__hot_cold_t(i64, i64, i8)
declare ptr @_ZnamRKSt9nothrow_t12__hot_cold_t(i64, ptr, i8)
declare ptr @_ZnamSt11align_val_tRKSt9nothrow_t12__hot_cold_t(i64, i64, ptr, i8)

attributes #0 = { builtin allocsize(0) "memprof"="cold" }
attributes #1 = { builtin allocsize(0) "memprof"="notcold" }
attributes #2 = { builtin allocsize(0) "memprof"="hot" }
;; NOTE: These prefixes are unused and the list is autogenerated. Do not add tests below this line:
; HOTCOLD: {{.*}}
