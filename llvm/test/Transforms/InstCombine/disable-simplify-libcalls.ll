; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 5
; Test that -disable-simplify-libcalls is wired up correctly.
;
; RUN: opt < %s -passes=instcombine -disable-simplify-libcalls -S | FileCheck %s

target datalayout = "e-p:64:64:64-i1:8:8-i8:8:8-i16:16:16-i32:32:32-i64:64:64-f32:32:32-f64:64:64-v64:64:64-v128:128:128-a0:0:64-s0:64:64-f80:128:128-n8:16:32:64-S128"

@.str  = constant [1 x i8] zeroinitializer, align 1
@.str1 = constant [13 x i8] c"hello, world\00", align 1
@.str2 = constant [4 x i8] c"foo\00", align 1
@.str3 = constant [4 x i8] c"bar\00", align 1
@.str4 = constant [6 x i8] c"123.4\00", align 1
@.str5 = constant [5 x i8] c"1234\00", align 1
@empty = constant [1 x i8] c"\00", align 1

declare double @ceil(double)
declare double @copysign(double, double)
declare double @cos(double)
declare double @fabs(double)
declare double @floor(double)
declare ptr @strcat(ptr, ptr)
declare ptr @strncat(ptr, ptr, i32)
declare ptr @strchr(ptr, i32)
declare ptr @strrchr(ptr, i32)
declare i32 @strcmp(ptr, ptr)
declare i32 @strncmp(ptr, ptr, i64)
declare ptr @strcpy(ptr, ptr)
declare ptr @stpcpy(ptr, ptr)
declare ptr @strncpy(ptr, ptr, i64)
declare i64 @strlen(ptr)
declare ptr @strpbrk(ptr, ptr)
declare i64 @strspn(ptr, ptr)
declare double @strtod(ptr, ptr)
declare float @strtof(ptr, ptr)
declare x86_fp80 @strtold(ptr, ptr)
declare i64 @strtol(ptr, ptr, i32)
declare i64 @strtoll(ptr, ptr, i32)
declare i64 @strtoul(ptr, ptr, i32)
declare i64 @strtoull(ptr, ptr, i32)
declare i64 @strcspn(ptr, ptr)
declare i32 @abs(i32)
declare i32 @ffs(i32)
declare i32 @ffsl(i64)
declare i32 @ffsll(i64)
declare i32 @fprintf(ptr, ptr)
declare i32 @isascii(i32)
declare i32 @isdigit(i32)
declare i32 @toascii(i32)
declare i64 @labs(i64)
declare i64 @llabs(i64)
declare i32 @printf(ptr)
declare i32 @sprintf(ptr, ptr)

define double @t1(double %x) {
; CHECK-LABEL: define double @t1(
; CHECK-SAME: double [[X:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call double @ceil(double [[X]])
; CHECK-NEXT:    ret double [[RET]]
;
  %ret = call double @ceil(double %x)
  ret double %ret
}

define double @t2(double %x, double %y) {
; CHECK-LABEL: define double @t2(
; CHECK-SAME: double [[X:%.*]], double [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call double @copysign(double [[X]], double [[Y]])
; CHECK-NEXT:    ret double [[RET]]
;
  %ret = call double @copysign(double %x, double %y)
  ret double %ret
}

define double @t3(double %x) {
; CHECK-LABEL: define double @t3(
; CHECK-SAME: double [[X:%.*]]) {
; CHECK-NEXT:    [[CALL:%.*]] = call double @cos(double [[X]])
; CHECK-NEXT:    ret double [[CALL]]
;
  %call = call double @cos(double %x)
  ret double %call
}

define double @t4(double %x) {
; CHECK-LABEL: define double @t4(
; CHECK-SAME: double [[X:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call double @fabs(double [[X]])
; CHECK-NEXT:    ret double [[RET]]
;
  %ret = call double @fabs(double %x)
  ret double %ret
}

define double @t5(double %x) {
; CHECK-LABEL: define double @t5(
; CHECK-SAME: double [[X:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call double @floor(double [[X]])
; CHECK-NEXT:    ret double [[RET]]
;
  %ret = call double @floor(double %x)
  ret double %ret
}

define ptr @t6(ptr %x) {
; CHECK-LABEL: define ptr @t6(
; CHECK-SAME: ptr [[X:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call ptr @strcat(ptr [[X]], ptr nonnull @empty)
; CHECK-NEXT:    ret ptr [[RET]]
;
  %ret = call ptr @strcat(ptr %x, ptr @empty)
  ret ptr %ret
}

define ptr @t7(ptr %x) {
; CHECK-LABEL: define ptr @t7(
; CHECK-SAME: ptr [[X:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call ptr @strncat(ptr [[X]], ptr nonnull @empty, i32 1)
; CHECK-NEXT:    ret ptr [[RET]]
;
  %ret = call ptr @strncat(ptr %x, ptr @empty, i32 1)
  ret ptr %ret
}

define ptr @t8() {
; CHECK-LABEL: define ptr @t8() {
; CHECK-NEXT:    [[RET:%.*]] = call ptr @strchr(ptr nonnull @.str1, i32 119)
; CHECK-NEXT:    ret ptr [[RET]]
;
  %ret = call ptr @strchr(ptr @.str1, i32 119)
  ret ptr %ret
}

define ptr @t9() {
; CHECK-LABEL: define ptr @t9() {
; CHECK-NEXT:    [[RET:%.*]] = call ptr @strrchr(ptr nonnull @.str1, i32 119)
; CHECK-NEXT:    ret ptr [[RET]]
;
  %ret = call ptr @strrchr(ptr @.str1, i32 119)
  ret ptr %ret
}

define i32 @t10() {
; CHECK-LABEL: define i32 @t10() {
; CHECK-NEXT:    [[RET:%.*]] = call i32 @strcmp(ptr nonnull @.str2, ptr nonnull @.str3)
; CHECK-NEXT:    ret i32 [[RET]]
;
  %ret = call i32 @strcmp(ptr @.str2, ptr @.str3)
  ret i32 %ret
}

define i32 @t11() {
; CHECK-LABEL: define i32 @t11() {
; CHECK-NEXT:    [[RET:%.*]] = call i32 @strncmp(ptr nonnull @.str2, ptr nonnull @.str3, i64 3)
; CHECK-NEXT:    ret i32 [[RET]]
;
  %ret = call i32 @strncmp(ptr @.str2, ptr @.str3, i64 3)
  ret i32 %ret
}

define ptr @t12(ptr %x) {
; CHECK-LABEL: define ptr @t12(
; CHECK-SAME: ptr [[X:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call ptr @strcpy(ptr [[X]], ptr nonnull @.str2)
; CHECK-NEXT:    ret ptr [[RET]]
;
  %ret = call ptr @strcpy(ptr %x, ptr @.str2)
  ret ptr %ret
}

define ptr @t13(ptr %x) {
; CHECK-LABEL: define ptr @t13(
; CHECK-SAME: ptr [[X:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call ptr @stpcpy(ptr [[X]], ptr nonnull @.str2)
; CHECK-NEXT:    ret ptr [[RET]]
;
  %ret = call ptr @stpcpy(ptr %x, ptr @.str2)
  ret ptr %ret
}

define ptr @t14(ptr %x) {
; CHECK-LABEL: define ptr @t14(
; CHECK-SAME: ptr [[X:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call ptr @strncpy(ptr [[X]], ptr nonnull @.str2, i64 3)
; CHECK-NEXT:    ret ptr [[RET]]
;
  %ret = call ptr @strncpy(ptr %x, ptr @.str2, i64 3)
  ret ptr %ret
}

define i64 @t15() {
; CHECK-LABEL: define i64 @t15() {
; CHECK-NEXT:    [[RET:%.*]] = call i64 @strlen(ptr nonnull @.str2)
; CHECK-NEXT:    ret i64 [[RET]]
;
  %ret = call i64 @strlen(ptr @.str2)
  ret i64 %ret
}

define ptr @t16(ptr %x) {
; CHECK-LABEL: define ptr @t16(
; CHECK-SAME: ptr [[X:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call ptr @strpbrk(ptr [[X]], ptr nonnull @.str)
; CHECK-NEXT:    ret ptr [[RET]]
;
  %ret = call ptr @strpbrk(ptr %x, ptr @.str)
  ret ptr %ret
}

define i64 @t17(ptr %x) {
; CHECK-LABEL: define i64 @t17(
; CHECK-SAME: ptr [[X:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call i64 @strspn(ptr [[X]], ptr nonnull @.str)
; CHECK-NEXT:    ret i64 [[RET]]
;
  %ret = call i64 @strspn(ptr %x, ptr @.str)
  ret i64 %ret
}

define double @t18(ptr %y) {
; CHECK-LABEL: define double @t18(
; CHECK-SAME: ptr [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call double @strtod(ptr nonnull @.str4, ptr [[Y]])
; CHECK-NEXT:    ret double [[RET]]
;
  %ret = call double @strtod(ptr @.str4, ptr %y)
  ret double %ret
}

define float @t19(ptr %y) {
; CHECK-LABEL: define float @t19(
; CHECK-SAME: ptr [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call float @strtof(ptr nonnull @.str4, ptr [[Y]])
; CHECK-NEXT:    ret float [[RET]]
;
  %ret = call float @strtof(ptr @.str4, ptr %y)
  ret float %ret
}

define x86_fp80 @t20(ptr %y) {
; CHECK-LABEL: define x86_fp80 @t20(
; CHECK-SAME: ptr [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call x86_fp80 @strtold(ptr nonnull @.str4, ptr [[Y]])
; CHECK-NEXT:    ret x86_fp80 [[RET]]
;
  %ret = call x86_fp80 @strtold(ptr @.str4, ptr %y)
  ret x86_fp80 %ret
}

define i64 @t21(ptr %y) {
; CHECK-LABEL: define i64 @t21(
; CHECK-SAME: ptr [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call i64 @strtol(ptr nonnull @.str5, ptr [[Y]], i32 10)
; CHECK-NEXT:    ret i64 [[RET]]
;
  %ret = call i64 @strtol(ptr @.str5, ptr %y, i32 10)
  ret i64 %ret
}

define i64 @t22(ptr %y) {
; CHECK-LABEL: define i64 @t22(
; CHECK-SAME: ptr [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call i64 @strtoll(ptr nonnull @.str5, ptr [[Y]], i32 10)
; CHECK-NEXT:    ret i64 [[RET]]
;
  %ret = call i64 @strtoll(ptr @.str5, ptr %y, i32 10)
  ret i64 %ret
}

define i64 @t23(ptr %y) {
; CHECK-LABEL: define i64 @t23(
; CHECK-SAME: ptr [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call i64 @strtoul(ptr nonnull @.str5, ptr [[Y]], i32 10)
; CHECK-NEXT:    ret i64 [[RET]]
;
  %ret = call i64 @strtoul(ptr @.str5, ptr %y, i32 10)
  ret i64 %ret
}

define i64 @t24(ptr %y) {
; CHECK-LABEL: define i64 @t24(
; CHECK-SAME: ptr [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call i64 @strtoull(ptr nonnull @.str5, ptr [[Y]], i32 10)
; CHECK-NEXT:    ret i64 [[RET]]
;
  %ret = call i64 @strtoull(ptr @.str5, ptr %y, i32 10)
  ret i64 %ret
}

define i64 @t25(ptr %y) {
; CHECK-LABEL: define i64 @t25(
; CHECK-SAME: ptr [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call i64 @strcspn(ptr nonnull @empty, ptr [[Y]])
; CHECK-NEXT:    ret i64 [[RET]]
;
  %ret = call i64 @strcspn(ptr @empty, ptr %y)
  ret i64 %ret
}

define i32 @t26(i32 %y) {
; CHECK-LABEL: define i32 @t26(
; CHECK-SAME: i32 [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call i32 @abs(i32 [[Y]])
; CHECK-NEXT:    ret i32 [[RET]]
;
  %ret = call i32 @abs(i32 %y)
  ret i32 %ret
}

define i32 @t27(i32 %y) {
; CHECK-LABEL: define i32 @t27(
; CHECK-SAME: i32 [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call i32 @ffs(i32 [[Y]])
; CHECK-NEXT:    ret i32 [[RET]]
;
  %ret = call i32 @ffs(i32 %y)
  ret i32 %ret
}

define i32 @t28(i64 %y) {
; CHECK-LABEL: define i32 @t28(
; CHECK-SAME: i64 [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call i32 @ffsl(i64 [[Y]])
; CHECK-NEXT:    ret i32 [[RET]]
;
  %ret = call i32 @ffsl(i64 %y)
  ret i32 %ret
}

define i32 @t29(i64 %y) {
; CHECK-LABEL: define i32 @t29(
; CHECK-SAME: i64 [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call i32 @ffsll(i64 [[Y]])
; CHECK-NEXT:    ret i32 [[RET]]
;
  %ret = call i32 @ffsll(i64 %y)
  ret i32 %ret
}

define void @t30() {
; CHECK-LABEL: define void @t30() {
; CHECK-NEXT:    [[TMP1:%.*]] = call i32 @fprintf(ptr null, ptr nonnull @.str1)
; CHECK-NEXT:    ret void
;
  call i32 @fprintf(ptr null, ptr @.str1)
  ret void
}

define i32 @t31(i32 %y) {
; CHECK-LABEL: define i32 @t31(
; CHECK-SAME: i32 [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call i32 @isascii(i32 [[Y]])
; CHECK-NEXT:    ret i32 [[RET]]
;
  %ret = call i32 @isascii(i32 %y)
  ret i32 %ret
}

define i32 @t32(i32 %y) {
; CHECK-LABEL: define i32 @t32(
; CHECK-SAME: i32 [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call i32 @isdigit(i32 [[Y]])
; CHECK-NEXT:    ret i32 [[RET]]
;
  %ret = call i32 @isdigit(i32 %y)
  ret i32 %ret
}

define i32 @t33(i32 %y) {
; CHECK-LABEL: define i32 @t33(
; CHECK-SAME: i32 [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call i32 @toascii(i32 [[Y]])
; CHECK-NEXT:    ret i32 [[RET]]
;
  %ret = call i32 @toascii(i32 %y)
  ret i32 %ret
}

define i64 @t34(i64 %y) {
; CHECK-LABEL: define i64 @t34(
; CHECK-SAME: i64 [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call i64 @labs(i64 [[Y]])
; CHECK-NEXT:    ret i64 [[RET]]
;
  %ret = call i64 @labs(i64 %y)
  ret i64 %ret
}

define i64 @t35(i64 %y) {
; CHECK-LABEL: define i64 @t35(
; CHECK-SAME: i64 [[Y:%.*]]) {
; CHECK-NEXT:    [[RET:%.*]] = call i64 @llabs(i64 [[Y]])
; CHECK-NEXT:    ret i64 [[RET]]
;
  %ret = call i64 @llabs(i64 %y)
  ret i64 %ret
}

define void @t36() {
; CHECK-LABEL: define void @t36() {
; CHECK-NEXT:    [[TMP1:%.*]] = call i32 @printf(ptr nonnull @empty)
; CHECK-NEXT:    ret void
;
  call i32 @printf(ptr @empty)
  ret void
}

define void @t37(ptr %x) {
; CHECK-LABEL: define void @t37(
; CHECK-SAME: ptr [[X:%.*]]) {
; CHECK-NEXT:    [[TMP1:%.*]] = call i32 @sprintf(ptr [[X]], ptr nonnull @.str1)
; CHECK-NEXT:    ret void
;
  call i32 @sprintf(ptr %x, ptr @.str1)
  ret void
}
