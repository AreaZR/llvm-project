; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 5
; RUN: opt -passes=instcombine -S -o - %s | FileCheck %s
; RUN: opt -passes=instcombine -S -o - %s --try-experimental-debuginfo-iterators | FileCheck %s

declare dso_local i32 @bar(ptr)

; Function Attrs: nounwind
define internal i32 @foo() #0 !dbg !1 {
; CHECK-LABEL: define internal i32 @foo(
; CHECK-SAME: ) #[[ATTR0:[0-9]+]] !dbg [[DBG4:![0-9]+]] {
; CHECK-NEXT:  [[ENTRY:.*:]]
; CHECK-NEXT:    [[VLA1:%.*]] = alloca [2 x i32], align 4, !dbg [[DBG16:![0-9]+]]
; CHECK-NEXT:      #dbg_declare(ptr [[VLA1]], [[META19:![0-9]+]], !DIExpression(), [[META20:![0-9]+]])
; CHECK-NEXT:    [[CALL:%.*]] = call i32 @bar(ptr nonnull [[VLA1]]) #[[ATTR0]], !dbg [[DBG21:![0-9]+]]
; CHECK-NEXT:    unreachable
;

entry:
  %vla = alloca i32, i64 2, align 4, !dbg !16
  call void @llvm.dbg.declare(metadata ptr %vla, metadata !19, metadata !DIExpression()), !dbg !20
  %call = call i32 @bar(ptr %vla), !dbg !22
  unreachable
}

; Function Attrs: nounwind readnone speculatable
declare void @llvm.dbg.declare(metadata, metadata, metadata) #1

attributes #0 = { nounwind }
attributes #1 = { nounwind readnone speculatable }

!llvm.dbg.cu = !{!5}
!llvm.module.flags = !{!0}

!0 = !{i32 2, !"Debug Info Version", i32 3}
!1 = distinct !DISubprogram(name: "a", scope: !2, file: !2, line: 232, type: !3, isLocal: true, isDefinition: true, scopeLine: 234, flags: DIFlagPrototyped, isOptimized: true, unit: !5, retainedNodes: !6)
!2 = !DIFile(filename: "b", directory: "c")
!3 = !DISubroutineType(types: !4)
!4 = !{}
!5 = distinct !DICompileUnit(language: DW_LANG_C99, file: !2, producer: "clang version", isOptimized: true, runtimeVersion: 0, emissionKind: FullDebug, enums: !4, retainedTypes: !4, globals: !4)
!6 = !{!7, !11}
!7 = !DILocalVariable(name: "__vla_expr", scope: !8, type: !10, flags: DIFlagArtificial)
!8 = distinct !DILexicalBlock(scope: !9, file: !2, line: 238, column: 39)
!9 = distinct !DILexicalBlock(scope: !1, file: !2, line: 238, column: 6)
!10 = !DIBasicType(name: "long unsigned int", size: 64, encoding: DW_ATE_unsigned)
!11 = !DILocalVariable(name: "ptr32", scope: !8, file: !2, line: 240, type: !12)
!12 = !DICompositeType(tag: DW_TAG_array_type, baseType: !13, elements: !14)
!13 = !DIBasicType(name: "unsigned int", size: 32, encoding: DW_ATE_unsigned)
!14 = !{!15}
!15 = !DISubrange(count: !7)
!16 = !DILocation(line: 240, column: 3, scope: !17)
!17 = distinct !DILexicalBlock(scope: !18, file: !2, line: 238, column: 39)
!18 = distinct !DILexicalBlock(scope: !1, file: !2, line: 238, column: 6)
!19 = !DILocalVariable(name: "ptr32", scope: !17, file: !2, line: 240, type: !12)
!20 = !DILocation(line: 240, column: 12, scope: !17)
!21 = !DILocation(line: 241, column: 65, scope: !17)
!22 = !DILocation(line: 241, column: 11, scope: !17)
;.
; CHECK: [[META0:![0-9]+]] = distinct !DICompileUnit(language: DW_LANG_C99, file: [[META1:![0-9]+]], producer: "clang version", isOptimized: true, runtimeVersion: 0, emissionKind: FullDebug, enums: [[META2:![0-9]+]], retainedTypes: [[META2]], globals: [[META2]])
; CHECK: [[META1]] = !DIFile(filename: "b", directory: {{.*}})
; CHECK: [[META2]] = !{}
; CHECK: [[DBG4]] = distinct !DISubprogram(name: "a", scope: [[META1]], file: [[META1]], line: 232, type: [[META5:![0-9]+]], scopeLine: 234, flags: DIFlagPrototyped, spFlags: DISPFlagLocalToUnit | DISPFlagDefinition | DISPFlagOptimized, unit: [[META0]], retainedNodes: [[META6:![0-9]+]])
; CHECK: [[META5]] = !DISubroutineType(types: [[META2]])
; CHECK: [[META6]] = !{[[META7:![0-9]+]], [[META11:![0-9]+]]}
; CHECK: [[META7]] = !DILocalVariable(name: "__vla_expr", scope: [[META8:![0-9]+]], type: [[META10:![0-9]+]], flags: DIFlagArtificial)
; CHECK: [[META8]] = distinct !DILexicalBlock(scope: [[META9:![0-9]+]], file: [[META1]], line: 238, column: 39)
; CHECK: [[META9]] = distinct !DILexicalBlock(scope: [[DBG4]], file: [[META1]], line: 238, column: 6)
; CHECK: [[META10]] = !DIBasicType(name: "long unsigned int", size: 64, encoding: DW_ATE_unsigned)
; CHECK: [[META11]] = !DILocalVariable(name: "ptr32", scope: [[META8]], file: [[META1]], line: 240, type: [[META12:![0-9]+]])
; CHECK: [[META12]] = !DICompositeType(tag: DW_TAG_array_type, baseType: [[META13:![0-9]+]], elements: [[META14:![0-9]+]])
; CHECK: [[META13]] = !DIBasicType(name: "unsigned int", size: 32, encoding: DW_ATE_unsigned)
; CHECK: [[META14]] = !{[[META15:![0-9]+]]}
; CHECK: [[META15]] = !DISubrange(count: [[META7]])
; CHECK: [[DBG16]] = !DILocation(line: 240, column: 3, scope: [[META17:![0-9]+]])
; CHECK: [[META17]] = distinct !DILexicalBlock(scope: [[META18:![0-9]+]], file: [[META1]], line: 238, column: 39)
; CHECK: [[META18]] = distinct !DILexicalBlock(scope: [[DBG4]], file: [[META1]], line: 238, column: 6)
; CHECK: [[META19]] = !DILocalVariable(name: "ptr32", scope: [[META17]], file: [[META1]], line: 240, type: [[META12]])
; CHECK: [[META20]] = !DILocation(line: 240, column: 12, scope: [[META17]])
; CHECK: [[DBG21]] = !DILocation(line: 241, column: 11, scope: [[META17]])
;.
